KasplatLocations = {
	[0] = { -- Japes
	--  [number] = {map, {x, y, z}, chunk, spoilerName, xmin, xmax, zmin, zmax, {kong_array}},
		[1] = {7, {870, 280, 3578}, 12, "Behind Rambi Wall", 740, 990, 3500, 3700, {1,2,3,4,5}},-- Behind Rambi Wall
		[2] = {7, {1592, 989, 2443}, 3, "On top of mountain", 1570, 1650, 2380, 2490, {1,2,3,4,5}},-- On top of mountain
		[3] = {7, {2270, 552, 3153}, 7, "Beehive Area", 2180, 2450, 3050, 3280, {1,2,3,4,5}},-- Beehive Area
		[4] = {7, {2769, 335, 2071}, 4, "Lower area of Tunnel to Beehive", nil, nil, nil, nil, {1,2,3,4,5}},-- Lower tunnel to Beehive
		[5] = {7, {3180, 437, 2379}, 5, "Upper area of Tunnel to Beehive", nil, nil, nil, nil, {1,2,3,4,5}},-- Upper tunnel to Beehive
		[6] = {33, {427, 20, 456}, 1, "Underground", nil, nil, nil, nil, {1,2,3,4,5}},-- Underground
		[7] = {7, {2014, 251, 2767}, 16, "Near Speedy Swing Sortie Bonus", nil, nil, nil, nil, {1,2,3,4,5}},-- Near SSSortie
		[8] = {7, {884, 280, 2578}, 9, "Near Painting Room", nil, nil, nil, nil, {1,2,3,4,5}},-- Near Painting Room
		[9] = {7, {1333, 280 ,1938}, 3, "Inside Tiny's Cage", 1320, 1360, 1910, 1960, {1,2,3,4,5}}, -- Tiny Cage GB
		[10] = {7, {899, 280, 640}, 0, "Starting Area", 800, 1100, 460, 800, {1,2,3,4,5}}, -- First Area
		[11] = {7, {2461, 280, 548}, 2, "Diddy Cave", 2370, 2620, 350, 650, {1,2,3,4,5}}, -- Diddy Cave
		[12] = {7, {1569, 160, 1844}, 3, "In the river", 1470, 1750, 1650, 2100, {1,2,3,4,5}}, -- In the river
		[13] = {7, {382, 140, 2818}, 13, "In the water near Rambi Wall", 360, 500, 2700, 2900, {1,2,3,4,5}}, -- In the water at the fairy
		[14] = {7, {1675, 280, 4197}, 14, "Near Cranky's", 1420, 1950, 4050, 4350, {1,2,3,4,5}}, -- Cranky Area
		[15] = {7, {773, 538, 2320}, 3, "In the T&S Alcove", 720, 800, 2295, 2380, {1,2,3,4,5}}, -- In the T&S alcove (with the DK bunch)
	},
	[1] = { -- Aztec
		[1] = {38, {2738, 120, 4763}, 11, "In the Stealthy Snoop Tunnel", 2640, 2825, 4650, 4850, {1,2,3,4,5}},-- In Stealthy Snoop Tunnel
		[2] = {38, {2467, 116, 990}, 4, "On the Oasis", 2350, 2500, 880, 1050, {1,2,3,4,5}},-- Oasis
		[3] = {38, {2129, 312, 1551}, 4, "On the Llama's Cage", 2110, 2155, 1525, 1590, {1,2,3,4,5}},-- On Llama Cage
		[4] = {38, {3782, 120, 2391}, 8, "Near the giant boulder", 3660, 4060, 2310, 2510, {1,2,3,4,5}},-- Tunnel (near big boulder)
		[5] = {38, {1363, 162, 738}, 3, "Behind the DK Stone Door", nil, nil, nil, nil, {1,2,3,4,5}},-- Behind DK Stone Door
		[6] = {20, {1378, 420, 3632}, 6, "In the lava room in Llama Temple", nil, nil, nil, nil, {1,2,3,4,5}},-- In Llama Temple
		[7] = {38, {3162, 120, 1845}, 6, "Near the Hunky Chunky Barrel", nil, nil, nil, nil, {1,2,3,4,5}},-- Tunnel (near Chunky Barrel)
		[8] = {38, {3301, 97, 3776}, 12, "Base of the Totem", 3275, 3308, 3768, 3790, {1,2,3,4,5}}, -- Base of Totem
		[9] = {38, {280, 138, 716}, 1, "In the Vase Room", 300, 420, 650, 750, {1,2,3,4,5}}, -- in the Chunky vase room
		[10] = {38, {1997, 280, 3500}, 12, "Behind the 5-Door Temple", 1970, 2020, 3470, 3520, {1,2,3,4,5}}, -- alcove in the back of 5DT
		[11] = {38, {3969, 190, 4037}, 12, "Near Snide's", 3930, 4020, 3990, 4080, {1,2,3,4,5}}, -- near Snide's
		[12] = {20, {1964, 472, 2408}, 0, "Below the Llama in Llama Temple", 1860, 2010, 2360, 2440, {1,2,3,4,5}}, -- In Llama temple, next to the llama (down)
		[13] = {16, {453, 345, 1465}, 4, "In the Free Tiny Room", 140, 720, 1200, 1700, {2,3,4,5}}, -- OKONG Room
	},
	[2] = { -- Factory
		[1] = {26, {1591, 1113, 615}, 18, "Near Funky's", 1570, 1680, 580, 800, {1,2,3,4,5}},-- By Funky's
		[2] = {26, {1712, 837, 2389}, 12, "Starting Area", 1680, 1740, 2300, 2440, {1,2,3,4,5}},-- Lobby
		[3] = {26, {1464, 127, 865}, 0, "Near the Power Hut", 1400, 1540, 840, 920, {1,2,3,4,5}},-- Power Hut Platform
		[4] = {26, {646, 460, 1792}, 7, "Down the pole covered by a Hatch", 600, 700, 1740, 1820, {1,2,3,4,5}},-- Middle Floor of Hatch Pole
		[5] = {26, {2053, 7, 573}, 1, "In the Dark Room", 2000, 2100, 500, 850, {1,2,3,4,5}},-- Dark Room
		[6] = {26, {633, 157, 1672}, 5, "On the lowest platform in Production Room", 550, 730, 1645, 1705, {1,2,3,4,5}},-- Lowest platform of Prod Room
		[7]	= {26, {782, 557, 1686}, 5, "Near the slippery pipe in Production Room", nil, nil, nil, nil, {1,2,3,4,5}},-- Near Lanky Pipe
		[8] = {26, {509, 0, 1591}, 5, "At the base of Production Room", nil, nil, nil, nil, {1,2,3,4,5}},-- Lower Production Room
		[9] = {26, {4148, 1336, 1016}, 23, "In Research & Development", nil, nil, nil, nil, {1,2,3,4,5}},-- In R&D
		[10] = {26, {1296, 6, 240}, 2, "Below the pole to the DK Arcade Machine", nil, nil, nil, nil, {1,2,3,4,5}},-- Below pole to Arcade
		[11] = {26, {2234, 1026, 1372}, 16, "In Block Tower Room", nil, nil, nil, nil, {1,2,3,4,5}},-- Block Tower Room
		[12] = {26, {621, 440, 1335}, 7, "Inside the central Crusher in Production Room", 600, 650, 1310, 1360, {1,2,3,4,5}},-- Inside the Crusher
		[13] = {26, {1276, 201, 710}, 0, "On Chunky's Cage", 1130, 1540, 530, 900, {1,2,3,4,5}}, -- On Chunky's Cage
		[14] = {26, {1579, 811, 2197}, 10, "Near Snide's", 1510, 1660, 2120, 2240, {1,2,3,4,5}}, -- Snide's
		[15] = {29, {116, 2, 121}, -1, "In the Power Shed", 68,151,66,154,{1}},-- Power Shed	
		--[16] = {26, {2664, 1034, 1834}, 8, "On the 1-16 Number Game"},-- Number game	
	},
	[3] = { -- Galleon
		[1] = {30, {3468, 1670, 3803}, 8, "Near the 3 Above-Ground treasure Chests", 3340, 3500, 3715, 3900, {1,2,3,4,5}},-- Chest area
		[2] = {30, {1631, 1611, 4162}, 9, "On the Lighthouse island", 1625, 1670, 4100, 4185, {1,2,3,4,5}},-- Lighthouse Platform
		[3] = {30, {3596, 1614, 1899}, 13, "Near Warp 5 on the 5-Door Ship Side", 3570, 3620, 1870, 1920, {1,2,3,4,5}},-- Floating Platform
		[4] = {30, {2037, 1750, 769}, 17, "On Diddy's Gold Tower", nil, nil, nil, nil, {1,2,3,4,5}},-- Gold Tower
		[5] = {30, {699, 1564, 4093}, 9, "In the Alcove near the Lighthouse", nil, nil, nil, nil, {1,2,3,4,5}},-- Near Chunky Instrument Pad
		[6] = {30, {1308, 1610, 2794}, 5, "On the platforms in Cannon Game Room", nil, nil, nil, nil, {1,2,3,4,5}},-- Cannon Game Room
		[7] = {30, {2806, 1890, 2969}, 6, "Near the T&S near Cranky's", nil, nil, nil, nil, {1,2,3,4,5}},-- Near Cranky T&S
		[8] = {30, {4372, 1650, 1031}, 13, "On the Cactus near the sunken submarine", nil, nil, nil, nil, {1,2,3,4,5}},-- Cactus
		[9] = {30, {3307, 1680, 2451}, 7, "On the Crown Pad", 3240, 3360, 2370, 2500, {1,2,3,4,5}}, -- Crown
		[10] = {30, {1249, 1451, 2876}, 5, "In the water in Cannon Game Room", 1160, 1300, 2700, 3000, {1,2,3,4,5}}, -- In the cannon room water
		[11] = {30, {3314, 1792, 2498}, 7, "Next to Cranky's", 3260, 3370, 2440, 2540, {1,2,3,4,5}}, -- on Cranky's platform
		--[12] = {30, {1885, 942, 3872}, 9, "Near the Enguarde Box on Lighthouse Side"},-- Near Enguarde Box
		--[13] = {30, {2547, 1173, 2000}, 12, "On the 5-Door Ship"}, -- On 5DS
		--[14] = {}, -- *On* K Rool's Ship
	},
	[4] = { -- Fungi
		[1] = {48, {4672, 153, 4130}, 2, "By the tag barrel near the exit to the Minecart", 4640, 4830, 4100, 4300, {1,2,3,4,5}},-- New Rainbow Coin
		[2] = {48, {3150, 273, 4332}, 4, "Behind the Diddy Dark Barn", 3100, 3200, 4330, 4420, {1,2,3,4,5}},-- Behind Diddy Barn
		[3] = {48, {1853, 230, 473}, 9, "Behind the beanstalk", 1780, 1890, 380, 780, {1,2,3,4,5}},-- Beanstalk
		[4] = {48, {183, 241, 756}, 11, "Near the rocketbarrel near the Giant Mushroom", 100, 380, 650, 940, {1,2,3,4,5}},-- Near GM Rocketbarrel
		[5] = {48, {850, 1250, 550}, 11, "At the top of the Giant Mushroom", 770, 1060, 530, 580, {1,2,3,4,5}},-- GM High Tag
		[6] = {48, {1250, 270, 4400}, 16, "Near the Anthill", 1170, 1390, 4220, 4575, {1,2,3,4,5}},-- Near Anthill
		[7] = {48, {2335, 143, 3639}, 15, "Near the sleeping Rabbit", 2150, 2450, 3540, 3730, {1,2,3,4,5}},-- Near Rabbit Race
		[8] = {48, {543, 194, 3748}, 17, "Near the T&S near the Owl's Tree", 320, 850, 3600, 4080, {1,2,3,4,5}},-- Near Tree T&S
		[9] = {48, {3693, 115, 1546}, 5, "Behind DK's Barn", nil, nil, nil, nil, {1,2,3,4,5}},-- Behind DK Barn
		[10] = {64, {329, 534, 402}, 0, "Inside the Giant Mushroom", nil, nil, nil, nil, {1,2,3,4,5}},-- In Giant Mushroom
		[11] = {48, {1270, 249, 3927}, 14, "Under the Owl's Tree", nil, nil, nil, nil, {1,2,3,4,5}},-- Under the Tree
		[12] = {48, {1290, 389, 678}, 11, "On a low platform on the exterior of Giant Mushroom", nil, nil, nil, nil, {1,2,3,4,5}},-- Lower platform (GM Exterior)
		[13] = {48, {732, 979, 597}, 11, "On a high platform on the exterior of Giant Mushroom", nil, nil, nil, nil, {1,2,3,4,5}},-- Upper platform (GM Exterior)
		[14] = {48, {2297, 604, 2318}, 0, "Behind the Cuckoo Clock", 2275, 2350, 2250, 2400, {1,2,3,4,5}}, -- Clock
		[15] = {61, {360, 0, 450}, 0, "Inside the mill", 200, 600, 360, 500, {1,2,3,4,5}}, -- Mill
		[16] = {48, {1009, 100, 576}, 11, "In the moat around the Giant Mushroom", 740, 1120, 540, 630, {1,2,3,4,5}}, -- Moat (GM Exterior)
	},
	[5] = { -- Caves
		[1] = {72, {2594, 14, 434}, 0, "In the room near the start", 2520, 2650, 370, 600, {1,2,3,4,5}},-- GGone Room
		[2] = {72, {1242, 65, 585}, 2, "Near Snide's", 1160, 1340, 500, 640, {1,2,3,4,5}},-- Snide's Room
		[3] = {72, {523, 181, 2498}, 6, "In the room with Tiny's Bonus Barrel", 360, 550, 2350, 2600, {1,2,3,4,5}},-- W3 Room
		[4] = {72, {752, 53, 778}, 8, "Inside an Ice Shield", 720, 800, 750, 830, {1,2,3,4,5}},-- Inside Chunky Ice Shield
		[5] = {72, {3645, 343, 1865}, 4, "On the Cabin with 5 Doors", 3590, 3650, 1580, 1880, {1,2,3,4,5}},-- 5DC Exterior
		[6] = {72, {2648, 173, 1770}, 4, "Near the headphones near Lanky's Cabin", 2550, 2830, 1730, 1860, {1,2,3,4,5}},-- Meme area near 1DC Headphones
		[7] = {72, {1915, 280, 2676}, 7, "In the room with the Giant Boulder", 1830, 2040, 2590, 2770, {1,2,3,4,5}},-- Giant Boulder Room
		[8] = {72, {1705, 285, 745}, 11, "Near the Ice Castle", nil, nil, nil, nil, {1,2,3,4,5}},-- Above Snide's Room
		[9] = {72, {3517, 286, 767}, 3, "In the Hidden Room by Funky's", nil, nil, nil, nil, {1,2,3,4,5}},-- Hidden W4 Room
		[10] = {72, {2783, 366, 927}, 9, "On the platform near Funky's", nil, nil, nil, nil, {1,2,3,4,5}},-- W5 Platform
		[11] = {72, {2911, 379, 1858}, 4, "By the Far Warp 2", nil, nil, nil, nil, {1,2,3,4,5}},-- Near Rotating Room
		[12] = {72, {577, 142, 1285}, 8, "On the 5-Door Igloo", nil, nil, nil, nil, {1,2,3,4,5}},-- On 5DI
		[13] = {72, {1340, 14, 2047}, 5, "In the water by the Baboon Blast Pad", 1240, 1490, 1920, 2170, {1,2,3,4,5}}, -- In the river near Pillar W4
		[14] = {72, {2434, 99, 1209}, 9, "Inbetween Funky's and the Ice Castle", 2260, 2500, 1130, 1240, {1,2,3,4,5}}, -- left side of river, near the edge where you jump across to climb to Funky's
	},
	[6] = { -- Castle
		[1] = {183, {439, 90, 1242}, 3, "In the Crypt, to the left", 340, 600, 1120, 1420, {1,2,3,4,5}},-- Crypt near D/D/C Entrance
		[2] = {183, {1839, 320, 1278}, 2, "In the Crypt, to the right", 1790, 1900, 1160, 1360, {1,2,3,4,5}},-- Crypt near L/T Entrance
		[3] = {163, {526, 195, 2013}, 1, "Inside the dungeon", 480, 600, 1400, 2570, {1,2,3,4,5}},-- Dungeon
		[4] = {87, {1655, 371, 2048}, 0, "Near the T&S at the back of Castle", 1600, 1720, 1970, 2090, {1,2,3,4,5}},-- Near exterior lower T&S
		[5] = {88, {547, 45, 613}, 2, "Inside the Ballroom", 340, 770, 330, 880, {1,2,3,4,5}},-- Ballroom
		[6] = {87, {1388, 1732, 1353}, 4, "At the top of the Castle", 1250, 1450, 1180, 1500, {1,2,3,4,5}},-- Top of Castle
		[7] = {164, {937, 400, 1424}, 2, "Inside the Tree", nil, nil, nil, nil, {1}},-- In Tree
		[8] = {183, {1112, 200, 1242}, 1, "In the Crypt, straight ahead", nil, nil, nil, nil, {1,2,3,4,5}},-- Crypt (central path)
		[9] = {87, {1892, 904, 1626}, 1, "Near the upper Warp 2", nil, nil, nil, nil, {1,2,3,4,5}},-- Near upper W2
		[10] = {87, {66, 392, 911}, 0, "Near the Crypt Entrance on a lone platform", nil, nil, nil, nil, {1,2,3,4,5}},-- Past Crypt (Exterior)
		[11] = {151, {536, 220, 2205}, 1, "Near Candy's", nil, nil, nil, nil, {1,2,3,4,5}},-- In Dungeon Tunnel
		[12] = {87, {845, 330, 235}, 0, "In the water near the Tree", 780, 930, 150, 300, {1,2,3,4,5}}, -- In the water by the drain pipe exit
		[13] = {87, {385, 1140, 1389}, 2, "Near Cranky's Hut", 320, 540, 1335, 1455, {1,2,3,4,5}}, -- by Cranky's hut
		[14] = {87, {195, 623, 542}, 0, "Near the Rocketbarrel by the drawbridge", 140, 220, 500, 570, {1,2,3,4,5}}, -- near the lower diddy RB
		[15] = {199, {740, 310, 630}, 0, "Inside the King Kutout Boss Fight", 615, 785, 615, 785, {1,2,3,4,5}}, -- King Kut Out Boss Fight
	},
	[7] = { -- Isles
		[1] = {169, {598, 0, 576}, 0, "Inside Jungle Japes Lobby", 200, 740, 320, 700, {1,2,3,4,5}},-- Japes Lobby
		[2] = {34, {3557, 497, 1555}, 0, "On the Beaver Beach", 3410, 3740, 1460, 1950, {1,2,3,4,5}},-- Beaver Beach
		[3] = {175, {676, 134, 372}, 0, "Inside Factory Lobby, above the DK Portal", 640, 710, 330, 430, {1,2,3,4,5}},-- Factory Lobby (upper platform)
		[4] = {170, {335, 191, 637}, 0, "Inside Hideout Helm Lobby", nil, nil, nil, nil, {1,2,3,4,5}},-- Helm Lobby
		[5] = {193, {577, 71, 766}, 0, "Inside Creepy Castle Lobby", nil, nil, nil, nil, {1,2,3,4,5}},-- Castle Lobby
		[6] = {194, {1674, 13, 685}, 1, "Inside Crystal Caves Lobby", nil, nil, nil, nil, {1,2,3,4,5}},-- Caves Lobby
		[7] = {175, {245, 81, 150}, 0, "Inside Factory Lobby, in the ? Box", nil, nil, nil, nil, {4}},-- Factory Lobby (In ? Box)
		[8] = {174, {762, 119, 900}, 0, "Inside Gloomy Galleon Lobby", nil, nil, nil, nil, {1,2,3,4,5}},-- Galleon Lobby
		[9] = {34, {4449, 552, 1673}, 0, "Inside the Rock which is blown up", 4260, 4560, 1520, 1780, {1,2,3,4,5}}, -- Big X Rock
		[10] = {34, {2357, 1199, 3903}, 1, "At the back of Kroc Isle, halfway up", 2320, 2440, 3855, 3910, {1,2,3,4,5}}, -- at the back of the W4 platform
		[11] = {34, {1578, 499, 457}, 0, "On the Big X Platform", 1475, 1685, 330, 565, {1,2,3,4,5}}, -- Big X
		[12] = {34, {2449, 1498, 785}, 0, "Behind the house to Fungi Lobby", 2430, 2480, 760, 800, {1,2,3,4,5}}, -- behind Fungi lobby
		--[13] = {171, {361, 85, 488}, 0, "Inside DK's House"}, -- In DK's House
		--[14] = {173, {1007, 0, 491}, 1, "Inside Aztec Lobby, behind Tiny's Switch Door"},-- Aztec Lobby (behind Tiny Switch door)
		--[15] = {}, -- Inside K Rool's Crown
	},
};

potential_enemies_table = {
	[1] = 0x0, -- Beaver
	[2] = 0x3B, -- Kremling
	[3] = 0x5, -- Zinger (Not Charger)
	[4] = 0x1C, -- Zinger (Charger)
	[5] = 0x67, -- Kosha
	[6] = 0x54, -- Krossbones
	[7] = 0x66, -- Pufftup
	[8] = 0x53, -- Robo-Zinger
	[9] = 0x50, -- Cutscene Object
	[10] = 0x21, -- Gold Beaver (Beaver Rando)
};

function getAvailableLocations(level,kong,taken_array)
	availabilityArray = {};
	for i = 1, #KasplatLocations[level] do
		allowedForKong = false;
		for j = 1, #KasplatLocations[level][i][9] do
			if KasplatLocations[level][i][9][j] == kong then
				allowedForKong = true;
			end
		end
		kasplatLocationTaken = true;
		for j = 1, #taken_array do
			if taken_array[j] == i then
				kasplatLocationTaken = false;
			end
		end
		if allowedForKong and not kasplatLocationTaken then
			availabilityArray[#availabilityArray + 1] = i;
		end
	end
	return availabilityArray;
end


function generateKasplatAssortment()
	kasplat_assortment = {};
	for i = 0, 7 do -- For each level
		temporary_kasplat_assortment = {};
		kasplat_assortment[i] = {};
		kasplat_seedSetting = (seedAsNumber * 5 * (i + 1));
		for j = 1, #KasplatLocations[i] do -- Generates a list of potential kasplat locations to select
			temporary_kasplat_assortment[j] = j;
		end
		if i == 7 then
			kasplat_assortment[7][4] = 7; -- Sets Tiny's Isles Kasplat to Factory Lobby
			table.remove(temporary_kasplat_assortment, 7);
		end
		math.randomseed(kasplat_seedSetting);
		for k = 1, 5 do -- 5 Kongs
			if i ~= 7 or k ~= 4 then --Excluding Tiny's Isles Kasplat
				available_locations = getAvailableLocations(i,k,temporary_kasplat_assortment);
				devPrint("Available Locations for Level "..i.." kong "..k..": ");
				devPrint(available_locations);
				selected_available_location = randomBetween(1, #available_locations);
				selected_temp_value = available_locations[selected_available_location];
				devPrint("Selected: "..selected_temp_value);
				kasplat_assortment[i][k] = selected_temp_value;
				for j = 1, #temporary_kasplat_assortment do
					if temporary_kasplat_assortment[j] == selected_temp_value then
						selected_removal_value = j;
					end
				end
				table.remove(temporary_kasplat_assortment, selected_removal_value);
				devPrint(temporary_kasplat_assortment);
			end
		end
	end
end

generateKasplatAssortment();

function replaceKasplats()
	current_cmap = mainmemory.read_u32_be(Mem.cmap[version]);
	if mapType(current_cmap) ~= "crown_maps" then
		for i = 1, 5 do
			kasplatTable = {}
			kasplatTable[1] = 0x3C + i;
			kasplats_kong = getEnemyPointerFromIds(kasplatTable);
			if #kasplats_kong > 0 then
				mainmemory.writebyte(kasplats_kong[1],0);
			end
		end
	end
end

function getKasplatCount(level)
	current_cmap = mainmemory.read_u32_be(Mem.cmap[version]);
	kasplat_count = 0;
	kasplats_in_map = {};
	if mapType(current_cmap) ~= "crown_maps" then
		for i = 1, 5 do
			value_to_check = kasplat_assortment[level][i];
			if current_cmap == KasplatLocations[level][value_to_check][1] then
				kasplat_count = kasplat_count + 1;
				kasplats_in_map[kasplat_count] = i;
			end
		end
	end
	return kasplat_count;
end

function isBetween(bound_lower, bound_upper, value)
	if value > bound_lower - 1 and value < bound_upper + 1 then
		return true;
	end
	if value > bound_upper - 1 and value < bound_lower + 1 then
		return true;
	end
	return false;
end

function spawnInNewKasplat(kasplatLevel,kasplatIndex,kasplatKong)
	freeMemory = 0x7FFE00;
	spawner_size = 0x48;
	m_box_size = 0x24;
	a_box_size = 0x30;
	current_cmap = mainmemory.read_u32_be(Mem.cmap[version]);
	for i = 1, #maps_with_no_spawners do
		if maps_with_no_spawners[i] == current_cmap then
			enemy_count = mainmemory.read_u16_be(Mem.num_enemies[version]);
			mainmemory.write_u16_be(Mem.num_enemies[version],enemy_count + 1);
			mainmemory.write_u32_be(Mem.enemy_respawn_object[version], 0x80000000 + freeMemory);
			createNewKasplatSpawner(freeMemory, freeMemory + spawner_size, freeMemory + spawner_size + m_box_size,kasplatKong,kasplatLevel,kasplatIndex);
		end
	end
end

function createNewKasplatSpawner(spawnerHeader,movementBoxHeader,aggBoxHeader,kong,level,kasplatLocationIndex)
	mainmemory.writebyte(spawnerHeader,0x3C + kong); -- Kasplat type
	for i = 1, 3 do
		mainmemory.write_s16_be(spawnerHeader + 2 + (2 * i), KasplatLocations[level][kasplatLocationIndex][2][i]); -- Set Positions
	end
	mainmemory.writebyte(spawnerHeader + 0xC, 35); -- Set Max Idle Speed
	mainmemory.writebyte(spawnerHeader + 0xD, 100);	-- Set Max Aggro Speed
	mainmemory.writebyte(spawnerHeader + 0xF, 50); -- Scale
	mainmemory.writebyte(spawnerHeader + 0x10, 1); -- Aggression
	mainmemory.writebyte(spawnerHeader + 0x13, 1); -- Spawn Trigger
	mainmemory.write_u32_be(spawnerHeader + 0x1C, 0x80000000 + movementBoxHeader); -- Movement Box Pointer
	mainmemory.writebyte(spawnerHeader + 0x42, 2); -- Spawner State
	mainmemory.write_s16_be(spawnerHeader + 0x40, KasplatLocations[level][kasplatLocationIndex][3]); -- Chunk
	mainmemory.writebyte(spawnerHeader + 0x44, 0x3C + kong); -- Alt Enemy Spawn
	
	x_min_kasplat = KasplatLocations[level][kasplatLocationIndex][5];
	x_max_kasplat = KasplatLocations[level][kasplatLocationIndex][6];
	z_min_kasplat = KasplatLocations[level][kasplatLocationIndex][7];
	z_max_kasplat = KasplatLocations[level][kasplatLocationIndex][8];
	x_kasplat = KasplatLocations[level][kasplatLocationIndex][2][1];
	y_kasplat = KasplatLocations[level][kasplatLocationIndex][2][2];
	z_kasplat = KasplatLocations[level][kasplatLocationIndex][2][3];
	
	mainmemory.write_s16_be(movementBoxHeader, x_min_kasplat);
	mainmemory.write_s16_be(movementBoxHeader + 0x2, z_min_kasplat);
	mainmemory.write_s16_be(movementBoxHeader + 0x4, x_max_kasplat);
	mainmemory.write_s16_be(movementBoxHeader + 0x6, z_max_kasplat);
	mainmemory.write_u32_be(movementBoxHeader + 0xC, 0x80000000 + aggBoxHeader); -- Aggression Box Pointer
	
	mainmemory.write_s16_be(aggBoxHeader + 0x0, KasplatLocations[level][kasplatLocationIndex][5]);
	mainmemory.write_s16_be(aggBoxHeader + 0xC, KasplatLocations[level][kasplatLocationIndex][5]);
	mainmemory.write_s16_be(aggBoxHeader + 0x6, KasplatLocations[level][kasplatLocationIndex][6]);
	mainmemory.write_s16_be(aggBoxHeader + 0x12, KasplatLocations[level][kasplatLocationIndex][6]);
	mainmemory.write_s16_be(aggBoxHeader + 0x4, KasplatLocations[level][kasplatLocationIndex][7]);
	mainmemory.write_s16_be(aggBoxHeader + 0x10, KasplatLocations[level][kasplatLocationIndex][7]);
	mainmemory.write_s16_be(aggBoxHeader + 0xA, KasplatLocations[level][kasplatLocationIndex][8]);
	mainmemory.write_s16_be(aggBoxHeader + 0x16, KasplatLocations[level][kasplatLocationIndex][8]);
	for i = 1, 4 do
		mainmemory.write_s16_be(aggBoxHeader + (6 * i) - 4, y_kasplat); -- + (20 * (1 - (2 * (i % 2))))
	end
	mainmemory.write_s16_be(aggBoxHeader + 26, y_kasplat); 
	mainmemory.write_s16_be(aggBoxHeader + 0x18, x_kasplat);
	mainmemory.write_s16_be(aggBoxHeader + 0x1C, z_kasplat);
end

maps_with_no_spawners = {
	0x1D, -- Power Shed
	0x3F, -- Fungi Slam Mushrooms Puzzle
	0x59, -- Rotating Room
	0xB0, -- Training Grounds
	0xC3, -- Snide's Room (DK Isles)
};

function writeKasplats(level)
	current_cmap = mainmemory.read_u32_be(Mem.cmap[version]);
	beavers_in_map = getEnemyPointerFromIds(potential_enemies_table);
	caves_enemies_xmin = 2483; -- 2484
	caves_enemies_xmax = 2681; -- 2680
	caves_enemies_zmin = 519; -- 520
	caves_enemies_zmax = 570; -- 569
	enemies_to_remove = {};
	enemy_removal_counter = 0;
	if current_cmap == 0x48 then -- Caves
		for i = 1, #beavers_in_map do
			x_pos_enemy = mainmemory.read_s16_be(beavers_in_map[i] + 4);
			z_pos_enemy = mainmemory.read_s16_be(beavers_in_map[i] + 8);
			if caves_enemies_xmax > x_pos_enemy and caves_enemies_xmin < x_pos_enemy then
				if caves_enemies_zmax > z_pos_enemy and caves_enemies_zmin < z_pos_enemy then
					enemy_removal_counter = enemy_removal_counter + 1;
					enemies_to_remove[enemy_removal_counter] = i;
				end
			end
		end
	end
	for j = #enemies_to_remove, 1, -1 do
		table.remove(beavers_in_map, enemies_to_remove[j]);
	end
	if mapType(current_cmap) ~= "crown_maps" then
		kasplat_direct_replacement = {};
		kdr_count = 0;
		beaver_table_swap = {};
		for i = 1, #kasplats_in_map do
			kong = kasplats_in_map[i];
			value_to_check = kasplat_assortment[level][kong];
			if #beavers_in_map > 0 then
				for k = 1, #beavers_in_map do
					if mainmemory.read_s16_be(beavers_in_map[k] + 4) == KasplatLocations[level][value_to_check][2][1] then
						if mainmemory.read_s16_be(beavers_in_map[k] + 6) == KasplatLocations[level][value_to_check][2][2] then
							if mainmemory.read_s16_be(beavers_in_map[k] + 8) == KasplatLocations[level][value_to_check][2][3] then
								mainmemory.writebyte(beavers_in_map[k],0x3C + kong); -- Set Enemy Value
								mainmemory.writebyte(beavers_in_map[k] + 0x44,0x3C + kong); -- Set Alternative Spawn Enemy Value
								for j = 1, 3 do
									mainmemory.write_s16_be(beavers_in_map[k] + 2 + (2 * j), KasplatLocations[level][value_to_check][2][j]); -- X/Y/Z
								end
								mainmemory.writebyte(beavers_in_map[k] + 0xF, 50); -- Scale
								mainmemory.write_s16_be(beavers_in_map[k] + 0x40, KasplatLocations[level][value_to_check][3]); -- Chunk
								kdr_count = kdr_count + 1;
								kasplat_direct_replacement[kdr_count] = kasplats_in_map[i];
								beaver_table_swap[kdr_count] = k;
							end
						end
					end
				end
			end
		end
		
		if #beaver_table_swap > 0 then
			previous_swap_largest = 100;
			for j = 1, #beaver_table_swap do
				swap_largest = 0;
				swap_number = 0;
				for i = 1, #beaver_table_swap do
					if beaver_table_swap[i] > swap_largest and beaver_table_swap[i] < previous_swap_largest then
						swap_largest = beaver_table_swap[i];
						swap_number = i;
					end
				end
				previous_swap_largest = swap_largest;
				table.remove(beavers_in_map,beaver_table_swap[swap_number]);
			end
		end
		
		if #beavers_in_map > 0 then
			for i = 1, #kasplats_in_map do
				kasplat_previously_replaced = 0;
				if kdr_count > 0 then
					for k = 1, kdr_count do
						if kasplat_direct_replacement[k] == kasplats_in_map[i] then
							kasplat_previously_replaced = 1;
						end
					end
				end
				if kasplat_previously_replaced == 0 then
					kong = kasplats_in_map[i];
					value_to_check = kasplat_assortment[level][kong];
					number_in_array = i;
					mainmemory.writebyte(beavers_in_map[number_in_array],0x3C + kong); -- Set Enemy Value
					mainmemory.writebyte(beavers_in_map[number_in_array] + 0x44,0x3C + kong); -- Set Alternative Spawn Enemy Value
					for j = 1, 3 do
						mainmemory.write_s16_be(beavers_in_map[number_in_array] + 2 + (2 * j), KasplatLocations[level][value_to_check][2][j]); -- X/Y/Z
					end
					mainmemory.writebyte(beavers_in_map[number_in_array] + 0xC, 35); -- Max Idle Speed
					mainmemory.writebyte(beavers_in_map[number_in_array] + 0xD, 100); -- Max Aggro Speed
					mainmemory.writebyte(beavers_in_map[number_in_array] + 0xF, 50); -- Scale
					mainmemory.writebyte(beavers_in_map[number_in_array] + 0x10, 1); -- Aggression
					mainmemory.write_s16_be(beavers_in_map[number_in_array] + 0x40, KasplatLocations[level][value_to_check][3]); -- Chunk
					box_address = mainmemory.read_u32_be(beavers_in_map[number_in_array] + 0x1C) - 0x80000000;
					agg_address = mainmemory.read_u32_be(box_address + 0xC) - 0x80000000
					box_size = 30;
					kasplat_x = KasplatLocations[level][value_to_check][2][1];
					kasplat_y = KasplatLocations[level][value_to_check][2][2];
					kasplat_z = KasplatLocations[level][value_to_check][2][3];
					x_min_offset = 0x0;
					x_max_offset = 0x4;
					z_min_offset = 0x2;
					z_max_offset = 0x6;
					x_min = mainmemory.read_s16_be(box_address + x_min_offset);
					z_min = mainmemory.read_s16_be(box_address + z_min_offset);
					x_max = mainmemory.read_s16_be(box_address + x_max_offset);
					z_max = mainmemory.read_s16_be(box_address + z_max_offset);
					x_min_select = KasplatLocations[level][value_to_check][5];
					x_max_select = KasplatLocations[level][value_to_check][6];
					z_min_select = KasplatLocations[level][value_to_check][7];
					z_max_select = KasplatLocations[level][value_to_check][8];
					if box_address > 0 and agg_address > 0 then
						if not isBetween(x_min, x_max, kasplat_x) or not isBetween(z_min, z_max, kasplat_z) then
							if KasplatLocations[level][value_to_check][5] ~= nil then
								mainmemory.write_s16_be(box_address + x_min_offset, KasplatLocations[level][value_to_check][5]);
								mainmemory.write_s16_be(box_address + x_max_offset, KasplatLocations[level][value_to_check][6]);
								mainmemory.write_s16_be(agg_address + 0x0, KasplatLocations[level][value_to_check][5]);
								mainmemory.write_s16_be(agg_address + 0xC, KasplatLocations[level][value_to_check][5]);
								mainmemory.write_s16_be(agg_address + 0x6, KasplatLocations[level][value_to_check][6]);
								mainmemory.write_s16_be(agg_address + 0x12, KasplatLocations[level][value_to_check][6]);
								mainmemory.write_s16_be(box_address + z_min_offset, KasplatLocations[level][value_to_check][7]);
								mainmemory.write_s16_be(box_address + z_max_offset, KasplatLocations[level][value_to_check][8]);
								mainmemory.write_s16_be(agg_address + 0x4, KasplatLocations[level][value_to_check][7]);
								mainmemory.write_s16_be(agg_address + 0x10, KasplatLocations[level][value_to_check][7]);
								mainmemory.write_s16_be(agg_address + 0xA, KasplatLocations[level][value_to_check][8]);
								mainmemory.write_s16_be(agg_address + 0x16, KasplatLocations[level][value_to_check][8]);
							end
						end
						for i = 1, 4 do
							mainmemory.write_s16_be(agg_address + (6 * i) - 4, kasplat_y); -- + (20 * (1 - (2 * (i % 2))))
						end
						mainmemory.write_s16_be(agg_address + 26, kasplat_y); 
						mainmemory.write_s16_be(agg_address + 0x18, kasplat_x);
						mainmemory.write_s16_be(agg_address + 0x1C, kasplat_z);
					end
				end
			end
		end
	end
end

kasplat_rando_happened = 0;

kongs = {
	[1] = "DK",
	[2] = "Diddy",
	[3] = "Lanky",
	[4] = "Tiny",
	[5] = "Chunky",
};

-- Movement Box Pointer = Spawner Object + 0x1C
-- Movement Box: x0, z0, x1, z1 = MB Pointer + 0x0/0x2/0x4/0x6
-- Aggression Box Pointer = MB Pointer + 0xC
-- Aggression Box: x0, y0, z0, x1, y1, z1: AB Pointer + 0x0/0x2/0x4/0x6/0x8/0xA
-- Aggression Box 2: x2, y2, z2, x3, y3, x3: AB Pointer + 0xC/0xE/0x10/0x12/0x14/0x16
-- Some other co-ordinate: AB Pointer + 0x18/0x1A/0x1C


function writeData()
	current_cmap = mainmemory.read_u32_be(Mem.cmap[version]);
	transition_speed_value = mainmemory.readfloat(Mem.transition_speed[version], true);
	obj_m2_timer_value = mainmemory.read_u32_be(Mem.obj_model2_timer[version]);
	levelIndexKasplats = mainmemory.readbyte(Mem.level_index_mapping[version] + current_cmap);
	for i = 0, 8 do
		if lobbies[i] == current_cmap then
			levelIndexKasplats = 7;
		end
	end
	if transition_speed_value < 0 and obj_m2_timer_value == 1 and kasplat_rando_happened == 0 then
		if levelIndexKasplats < 8 then
			map_has_native_spawner = true;
			for i = 1, #maps_with_no_spawners do
				if maps_with_no_spawners[i] == current_cmap then
					map_has_native_spawner = false;
				end
			end
			if map_has_native_spawner then
				replaceKasplats();
				getKasplatCount(levelIndexKasplats);
				writeKasplats(levelIndexKasplats);
				devPrint("Kasplats Inserted: "..#kasplats_in_map);
			else
				for i = 1, 5 do
					kasplatLocationIndex_to_lookup = kasplat_assortment[levelIndexKasplats][i];
					kasplat_map = KasplatLocations[levelIndexKasplats][kasplatLocationIndex_to_lookup][1];
					if kasplat_map == current_cmap then
						spawnInNewKasplat(levelIndexKasplats,kasplatLocationIndex_to_lookup,i);
						devPrint("Kasplats Inserted: 1");
					end
				end
			end
			kasplat_rando_happened = 1;
		end
	elseif transition_speed_value > 0 then
		kasplat_rando_happened = 0;
	end
end

event.onframeend(writeData, "Randomises Kasplat Location");